<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>WebXR Test Básico - Cubo AR</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: sans-serif; }
        canvas { display: block; }
        #ar-button {
            position: absolute;
            bottom: 20px;
            right: 20px;
            z-index: 999;
        }
    </style>

    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.163.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.163.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>
    <script type="module">
        import * as THREE from 'three';
        import { ARButton } from 'three/addons/webxr/ARButton.js'; // Usar ARButton

        let camera, scene, renderer;
        let cube;

        init();

        function init() {
            console.log("Iniciando Test Básico Cubo AR...");

            scene = new THREE.Scene(); // Crear escena

            // Cámara (su posición será controlada por el headset en AR)
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 100);
            // Posición inicial no muy relevante en AR
            camera.position.set(0, 1.6, 0); // Ajustar si es necesario para vista no-AR

            // Renderer (con alpha para passthrough)
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setClearAlpha(0); // Fondo transparente
            renderer.xr.enabled = true; // Habilitar WebXR
            document.body.appendChild(renderer.domElement);

            // Botón AR
            const arButton = ARButton.createButton(renderer);
            document.body.appendChild(arButton);
            console.log("AR Button creado.");

            // Luz simple
            const ambientLight = new THREE.AmbientLight(0xffffff, 1.0);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5);
            directionalLight.position.set(1, 1, 1).normalize();
            scene.add(directionalLight);


            // --- Crear el Cubo ---
            const geometry = new THREE.BoxGeometry(0.2, 0.2, 0.2); // Cubo pequeño
            const material = new THREE.MeshStandardMaterial({
                color: 0x00ff00, // Verde
                roughness: 0.7,
                metalness: 0.1
             });
            cube = new THREE.Mesh(geometry, material);
            // Posicionar el cubo delante del usuario al iniciar AR
            cube.position.set(0, 1.5, -1); // 1m delante, 1.5m alto (ajusta según veas)
            scene.add(cube);
            console.log("Cubo creado y añadido a la escena.");

            // --- Eventos ---
            window.addEventListener('resize', onWindowResize);

            // --- Iniciar Bucle de Animación ---
            renderer.setAnimationLoop(animate);
            console.log("Inicialización completa. Iniciando bucle.");
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // Bucle de animación
        function animate() {
            // Rotar el cubo
            if (cube) {
                cube.rotation.x += 0.01;
                cube.rotation.y += 0.01;
            }

            // Renderizar la escena (Three.js maneja la cámara AR automáticamente)
            try {
                renderer.render(scene, camera);
            } catch(e) {
                console.error("Error en render loop:", e);
                // Detener bucle si hay error de renderizado grave
                // renderer.setAnimationLoop(null);
            }
        }

    </script>
</body>
</html>





